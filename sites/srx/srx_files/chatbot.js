var isMobile={Android:function(){return/Android/i.test(navigator.userAgent)},BlackBerry:function(){return/BlackBerry/i.test(navigator.userAgent)},iOS:function(){return/iPhone|iPod/i.test(navigator.userAgent)},iOSPad:function(){return/iPad/i.test(navigator.userAgent)},Windows:function(){return/IEMobile/i.test(navigator.userAgent)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Windows()}};window.setCookieGlobal=function(t,e){var o=new Date;o.setTime(o.getTime()+108e5);var n="expires="+o.toUTCString();document.cookie=t+"="+e+"; "+n+"; path=/"},window.getCookieGlobal=function(t){for(var e=t+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var a=o[n];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(e))return a.substring(e.length,a.length)}return""};var delete_cookie=function(t){document.cookie=t+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"};$(function(){function t(t){var e="Today",o=new Date;t.toLocaleDateString()!=o.toLocaleDateString()&&(e=t.toString().split(" ")[0]);var n=t.toLocaleTimeString("en-SG",{hour12:!0}).split(" ");return n[0].substring(0,n[0].length-3)+n[1]+", "+e}function e(){var t=$(".bot-contact-conversation:visible")[0];$(t).animate({scrollTop:t.scrollHeight},500)}function o(o,n,a){var c=t(n);i.append('<span class="user-converse"><div><span class="time">'+c+'</span><span class="who">You</span></div><div class="arrow_box">'+function(t){return/[<>/]/g.test(t)?t.replace(/[<>/&"]/g,""):t}(o)+"</div></span>"),a&&e()}function n(o,n,a){var c=t(n),s=o||'<div class="dot"></div><div class="dot"></div><div class="dot"></div>';i.append('<span class="bot-converse"><div><span class="who">'+$("#bot-name").val()+'</span><span class="time">'+c+'</span></div><div class="arrow_box loading">'+s.replace(/\n/g,"<br>")+"<div></span>"),a&&e()}function a(o){t(new Date);$loadingBox=i.children(".bot-converse:last").children(".loading"),0==$loadingBox.length?($loadingBox=i.children(".bot-converse:last").clone(),$loadingBox.find(".arrow_box").html(o.replace(/\n/g,"<br>")),i.append($loadingBox)):($loadingBox.removeClass("loading"),$loadingBox.append(o.replace(/\n/g,"<br>"))),e()}function c(){var t=$(".bot-contact-form-content-message textarea:visible").val().slice(""),e=$("#bot-user-token").val();o(t,new Date,!0),n(null,new Date,!0),$(".bot-contact-form-textarea").val("").html(""),s($(".bot-contact-form-textarea:visible"),!0);var c=1;$("#hiddenPtUserId").length>0&&(c=4);$.ajax("/chatbot/client.srx",{type:"POST",dataType:"json",data:{action:"ask",userToken:e,message:t,channel:c},success:function(t){var e=t.po;if(e.response){var o=e.response;if(e.responseUrl&&(o+='<br><a href="'+e.responseUrl+'" target="_self">View details</a>'),a(o),e.secondaryPos&&e.secondaryPos.length>0)for(var n=0;n<e.secondaryPos.length;n++){var c=e.secondaryPos[n],s=c.response;c.responseUrl&&(s+='<br><a href="'+c.responseUrl+'" target="_self">View details</a>'),a(s)}}$("#bot-user-token").val(e.userToken),setCookieGlobal(l,e.userToken)}})}function s(t,e){t.height(0);var o=parseInt(t.css("max-height")),n=t[0].scrollHeight>o?o:t[0].scrollHeight;e&&(n=r),t.height(n);var a=(n-$(".bot-button-send:visible").height())/2;$(".bot-button-send:visible").css({"margin-top":a+"px"})}var r=$(".bot-contact-form-content-message textarea").height();delete_cookie("bot_any_questions"),$("#tracker-contact").length>0&&($("#bot-contact").remove(),$("#bot-contact-mobile").remove()),$("#bot-contact .show-callout").click(function(t){$(".bot-contact-form").hasClass("callout-open")?($(".bot-contact-form").removeClass("callout-open"),$("#bot-contact-agent").addClass("callout-open"),$("#bot-contact").removeClass("bot-contact-selected")):(enquire.register("screen and (max-width:480px)",{match:function(){window.location="/chatbot"},unmatch:function(){}}),!isMobile.any()||isMobile.iOSPad()||isMobile.Android()&&window.innerWidth>500?($(".bot-contact-form").addClass("callout-open"),$("#bot-contact-agent").addClass("bot-contact-agent-close"),$("#bot-contact-form-sm").focus(),$("#bot-contact-conversation-sm").find(".user-converse").length>0&&e(),$("#bot-contact").addClass("bot-contact-selected")):$("#bot-contact-form-xs").focus()),t.preventDefault()}),$(".bot-contact-agent-image").mouseenter(function(){isMobile.any()||isMobile.iOSPad()||!getCookieGlobal(l)||$("#bot-contact-agent-callout").hide()}),$(".bot-contact-agent-image").mouseleave(function(){!isMobile.any()&&getCookieGlobal(l)&&$("#bot-contact-agent-callout").hide()}),$(document).bind("mousedown touchstart",function(t){var e=$(".bot-contact-form");e.hasClass("callout-open")&&!e.is(t.target)&&0===e.has(t.target).length&&(e.removeClass("callout-open"),$("#bot-contact").removeClass("mobile-contact"),$("#bot-contact-agent").removeClass("bot-contact-agent-close"),$(".bot-contact-form-content-message textarea").focusout(),$(".bot-contact-form-content-message textarea").blur(),$("#bot-contact").removeClass("bot-contact-selected")),$("body").removeAttr("style")}),$(".bot-contact-form-textarea").keyup(function(t){$(this).removeAttr("rows");var e=t.keyCode;void 0===e&&(e=t.key?t.key:t.which),13==e&&""!=$(".bot-contact-form-textarea:visible").val().trim()?$(".bot-contact-form-textarea:visible").val().length>0&&(t.preventDefault(),c()):1!=$(this)[0].rows&&s($(this))}),$(".bot-button-send").click(function(t){$(".bot-contact-form-textarea:visible").focus(),$(".bot-contact-form-textarea:visible").val().trim().length>0&&c(),t.preventDefault()});var i=window.screen.width<768||window.screen.height<768?$("#bot-contact-conversation-xs > .bot-conversation"):$("#bot-contact-conversation-sm > .bot-conversation");$(".bot-contact-form-content-message-overview-bottom button").click(function(t){$(".bot-contact-form-content-message-overview").hide(),$(".bot-contact-form-content").show(),$(".bot-contact-form-content-message textarea").val(""),$(".bot-contact-form-content-message-overview-main").val(""),t.preventDefault()}),$(".bot-contact-form-header a.glyphicon-remove").click(function(t){$("#bot-contact").removeClass("mobile-contact"),$(".bot-contact-form").removeClass("callout-open"),$("#bot-contact-agent").removeClass("bot-contact-agent-close"),$(".bot-contact-form-content-message textarea").focusout(),$(".bot-contact-form-content-message textarea").blur(),$("#bot-contact").removeClass("bot-contact-selected"),isMobile.any()&&(""==document.referrer?window.location.href="/":window.location.href=document.referrer),$("body").removeAttr("style"),t.preventDefault()});var l="seviUserToken";if(getCookieGlobal(l)){var b=getCookieGlobal(l);$("#bot-user-token").val(b);$.ajax("/chatbot/client.srx",{type:"POST",dataType:"json",data:{action:"loadThreads",userTokenId:b},success:function(t){!function(t){for(var e=0;e<t.length;e++){o(t[e].userMessage,new Date(t[e].dateCreate.time),!1);var a=t[e].responseUrl,c="";a&&(-1!=a.indexOf("?")?a+="&":a+="?",c=(a+="ut_source=sevi")?'<br/><a href="'+a+'" target="_self">View details</a>':""),n(t[e].systemMessage+c,new Date(t[e].dateCreate.time),!1)}}(t.threads)}})}!isMobile.any()&&(document.location.href.indexOf("#showbot")>-1||window.location.href.indexOf("ut_source")>-1)&&($(".bot-contact-form").addClass("callout-open"),$("#bot-contact-agent").addClass("bot-contact-agent-close"),$("#bot-contact-form-sm").focus(),$("#bot-contact-conversation-sm").find(".user-converse").length>0?e():setTimeout(function(){e()},500),$("#bot-contact").addClass("bot-contact-selected")),$("#chatbot-page").length>0&&($("#bot-contact-minimized").hide(),setTimeout(function(){e()},500))});