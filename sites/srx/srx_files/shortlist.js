$(function(){var t=$(".addToFavourites"),e=$(".notAddedFavorites"),i="true"==$("#userLoggedIn").val();e.click(function(){var t=$(this),e=$(this).attr("id");if(i)$.ajax("/srx/shopcart/addItem/call.srx",{type:"POST",cache:!1,dataType:"json",data:{item:'{isSaved:false, refType:"0", encryptedRefId: "'+e+'"}'},error:function(t){alert("Error when shortlisting listing.")},success:function(i){1==i.existing?alert("Item is existing on your cart already."):i.errorMessage?alert(i.errorMessage):(t.parent().append("<input type='hidden' class='listingShoppingCartId' value='"+i.itemId+"' />"),s("add"),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Shortlist","Logged In",e]))}});else{var o=decodeURIComponent(n("shortlist"));if(""==o)$.cookie("shortlist",e,{expires:7,path:"/"}),s("add");else{for(var a=o.split(";"),d=!0,l=0;l<a.length;l++)a[l]==e&&(d=!1);d&&(o+=";"+e,$.cookie("shortlist",o,{expires:7,path:"/"}),s("add"),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Shortlist","Not Logged In",e]))}""!=n("shortlistTip")||i||($("#shortlistTip").modal("show"),r("shortlistTip",1))}return!1}),$("#shortlistLogin").click(function(t){$("#shortlistTip").modal("hide"),openModalWithCustombox("#header-login-popup"),t.preventDefault()}),$(".addedFavorites").click(function(t){t.preventDefault()});var s=function(t){var e=parseInt($(".shortlist-cart:first").text());"add"==t?e+=1:(e-=1)<0&&(e=0),$(".shortlist-cart").text(e),$(".showCartCounter").text(e)};$("#listing-shortlist,.listing-shortlist").click(function(t){if(t.preventDefault(),$(this).hasClass("shortlisted"))alert("This listing has already been shortlisted.");else{var e=$(this).attr("id"),a=$(this).data("id");if(i)$.ajax("/srx/shopcart/addItem/call.srx",{type:"POST",cache:!1,dataType:"json",data:{item:'{isSaved:false, refType:"0", encryptedRefId: "'+e+'"}'},error:function(t){alert("Error when shortlisting listing.")},success:function(t){if(1==t.existing){$.ajax("/srx/shopcart/removeItem/call.srx",{type:"POST",cache:!1,dataType:"json",async:!1,data:{encryptedListingId:a},context:self,error:function(t){alert("Error when Removing Cart Item.")},success:function(t){"1"==t.result&&($("#"+e).find(".shorlisted").hide(),$("#"+e).find(".shorlist").show())}})}else s("add"),$("#"+e).find(".shorlist").hide(),$("#"+e).find(".shorlisted").show()}});else{var d=decodeURIComponent(n("shortlist"));if(""==d)$.cookie("shortlist",e,{expires:7,path:"/"}),s("add"),$("#"+e).find(".shorlisted").show(),$("#"+e).find(".shorlist").hide();else{for(var l=d.split(";"),h=!0,c=0;c<l.length;c++)l[c]==e&&(h=!1);if(!h){var f=decodeURIComponent(n("shortlist")).split(";");if(f.length>0){for(c=0;c<=f.length;c++){"undefined"!=typeof f[c]&&f[c]==e&&(console.log(f[c]),f.splice(c,1))}var p=f.join(";");o("shortlist"),r("shortlist",p)}return $("#"+e).find(".shorlisted").hide(),$("#"+e).find(".shorlist").show(),!1}r("shortlist",d+=";"+e),s("add"),$("#"+e).find(".shorlist").hide(),$("#"+e).find(".shorlisted").show()}}$("#listing-shortlist .listing-shortlist-text").html("Shortlisted"),$(this).find(".listing-shortlist-text").html("Shortlisted"),$("#listing-shortlist").addClass("shortlisted")}return!1});var r=function(t,e){var i=new Date;i.setTime(i.getTime()+18e5);var s="expires="+i.toUTCString();document.cookie=t+"="+encodeURIComponent(e)+"; "+s+"; path=/"},o=function(t){document.cookie=t+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"},n=function(t){for(var e=t+"=",i=document.cookie.split(";"),s=0;s<i.length;s++){for(var r=i[s];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(e))return r.substring(e.length,r.length)}return""};if(!i){var a=decodeURIComponent(n("shortlist")).split(";");a.length>0&&t.each(function(){var t=$(this).find(".listingEncryptedId").val();a.indexOf(t)>-1&&($(this).find(".addedFavorites").show(),$(this).find(".notAddedFavorites").hide())})}});